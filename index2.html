<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora al Paralelo</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat:400,700&display=swap">
    <style>
        body { font-family: 'Montserrat', Arial, sans-serif; margin: 0; background: #f7f9fb; }
        .container { max-width: 430px; margin: 40px auto; background: #fff; border-radius: 30px; box-shadow: 0 10px 32px 0 rgba(44,82,180,.16); overflow: hidden;}
        .header { background: linear-gradient(135deg,#3b41e3 60%,#7f9cf5 100%); color: #fff; padding: 38px 30px 24px 30px;}
        .header h1 { margin: 0 0 10px 0; font-size: 2rem; letter-spacing: 0.04em;}
        .header p { font-size: 1.1rem; margin: 0; opacity: 0.92;}
        .input-area { background: #f7f9fb; padding: 20px 30px 0 30px;}
        .input-box { display: flex; margin-bottom: 18px;}
        .input-box input { flex: 1; padding: 16px; font-size: 1.2rem; border: none; border-radius: 18px 0 0 18px; outline: none; background: #e5e8f5;}
        .input-box button { padding: 0 32px; border: none; border-radius: 0 18px 18px 0; background: #3b41e3; color: #fff; font-size: 1.05rem; cursor: pointer; transition: background 0.2s;}
        .input-box button:hover { background: #2327a3;}
        .rate-area { display: flex; gap: 10px; justify-content: center; padding: 0 30px 15px 30px;}
        .rate-box { flex: 1; background: #f1f2f6; border-radius: 18px; padding: 16px 0; text-align: center; margin-bottom: 4px; box-shadow: 0 2px 10px 0 rgba(44,82,180,.06);}
        .rate-label { font-size: 0.99rem; color: #6979a7;}
        .rate-value { font-weight: 700; font-size: 1.4rem; color: #363e6a; margin-top: 5px;}
        .list-title { font-size: 1.09rem; font-weight: 600; color: #3b41e3; margin: 14px 0 7px 0; display: flex; align-items: center; gap: 8px;}
        .list-title .emoji { font-size: 1.2em; }
        .moneda-list, .crypto-list { margin: 0 20px 0 20px; padding: 0; list-style: none; }
        .moneda-item, .crypto-item { display: flex; align-items: center; padding: 12px 0; border-bottom: 1px solid #ececec; font-size: 1.07rem;}
        .moneda-item:last-child, .crypto-item:last-child { border-bottom: none; }
        .moneda-flag, .crypto-flag { width: 38px; height: 38px; border-radius: 50%; object-fit: cover; margin-right: 14px; background: #f2f3f8; box-shadow: 0 2px 8px 0 rgba(0,0,0,0.05);}
        .crypto-list { margin-bottom: 24px;}
        .crypto-label { font-weight: 500;}
        .crypto-amount { margin-left: auto; font-weight: 700; color: #363e6a; font-size: 1.09rem;}
        @media (max-width: 650px) { .container { margin: 0; max-width: 100vw; border-radius: 0; } }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Calculadora al Paralelo</h1>
            <p>Convierte BOB a diferentes monedas al instante</p>
        </div>
        <div class="input-area">
            <form id="calc-form" autocomplete="off">
                <div class="input-box">
                    <input type="number" id="monto" min="1" placeholder="Monto en BOB" required />
                    <button type="submit">BOB</button>
                </div>
            </form>
            <div class="rate-area">
                <div class="rate-box">
                    <div class="rate-label">USD/BOB</div>
                    <div class="rate-value" id="usd-rate">-</div>
                </div>
                <div class="rate-box">
                    <div class="rate-label">EUR/BOB</div>
                    <div class="rate-value" id="eur-rate">-</div>
                </div>
            </div>
        </div>
        <div style="padding-bottom: 16px;">
            <div class="list-title"><span class="emoji">💱</span>Monedas tradicionales</div>
            <ul class="moneda-list" id="fiat-list"></ul>
            <div class="list-title"><span class="emoji">💾</span>Criptomonedas</div>
            <ul class="crypto-list" id="crypto-list"></ul>
        </div>
    </div>
<script>
const API_URL = 'https://api.lupo.lat/convertir_bob';
const CACHE_KEY = 'paralelo_cache';
const CACHE_TIME = 2 * 60 * 1000; // 2 minutos en ms

const fiatCurrencies = {
    "Dólar estadounidense": { code: "USD", icon: "https://currencyfreaks.com/photos/flags/usd.png" },
    "Euro": { code: "EUR", icon: "https://currencyfreaks.com/photos/flags/eur.png" },
    "Peso colombiano": { code: "COP", icon: "https://currencyfreaks.com/photos/flags/cop.png" },
    "Peso argentino": { code: "ARS", icon: "https://currencyfreaks.com/photos/flags/ars.png" },
    "Peso chileno": { code: "CLP", icon: "https://currencyfreaks.com/photos/flags/clp.png" },
    "Real brasileño": { code: "BRL", icon: "https://currencyfreaks.com/photos/flags/brl.png" },
    "Sol peruano": { code: "PEN", icon: "https://currencyfreaks.com/photos/flags/pen.png" },
    "Guaraní paraguayo": { code: "PYG", icon: "https://currencyfreaks.com/photos/flags/pyg.png" },
    "Yuan chino": { code: "CNY", icon: "https://currencyfreaks.com/photos/flags/cny.png" },
    "Peso mexicano": { code: "MXN", icon: "https://currencyfreaks.com/photos/flags/mxn.png" }
};

// Usa tus archivos subidos en /paralelo/
const cryptoCurrencies = {
    "Tether (USDT)": { code: "USDT", icon: "paralelo/1.png" },
    "BTC": { code: "BTC", icon: "paralelo/2.png" },
    "ETH": { code: "ETH", icon: "paralelo/3.png" },
    "USDC": { code: "USDC", icon: "paralelo/4.png" },
    "DOGE": { code: "DOGE", icon: "paralelo/5.png" },
    "SOL": { code: "SOL", icon: "paralelo/6.png" },
    "PEPE": { code: "PEPE", icon: "paralelo/7.png" },
    "TRUMP": { code: "TRUMP", icon: "paralelo/8.png" }
};

const montoInput = document.getElementById('monto');
const fiatList = document.getElementById('fiat-list');
const cryptoList = document.getElementById('crypto-list');
const usdRate = document.getElementById('usd-rate');
const eurRate = document.getElementById('eur-rate');
const form = document.getElementById('calc-form');

function setLoading() {
    fiatList.innerHTML = `<li class='moneda-item'>Cargando...</li>`;
    cryptoList.innerHTML = `<li class='crypto-item'>Cargando...</li>`;
}

function renderFiat(cambios) {
    fiatList.innerHTML = '';
    Object.keys(fiatCurrencies).forEach(mon => {
        let val = cambios[mon];
        if (typeof val !== 'number') val = 0;
        fiatList.innerHTML += `<li class='moneda-item'>
            <img src='${fiatCurrencies[mon].icon}' class='moneda-flag'>
            <div>
                <div>${mon}</div>
                <div style='font-size:12px;color:#888;'>${fiatCurrencies[mon].code}</div>
            </div>
            <div class='crypto-amount'>${val.toLocaleString('es-ES', {minimumFractionDigits:2, maximumFractionDigits:2})}</div>
        </li>`;
    });
}

function renderCripto(cambios) {
    cryptoList.innerHTML = '';
    Object.keys(cryptoCurrencies).forEach(mon => {
        let val = cambios[mon];
        if (typeof val !== 'number') val = 0;
        cryptoList.innerHTML += `<li class='crypto-item'>
            <img src='${cryptoCurrencies[mon].icon}' class='crypto-flag'>
            <span class='crypto-label'>${mon}</span>
            <span class='crypto-amount'>${val.toLocaleString('es-ES', {minimumFractionDigits:2, maximumFractionDigits:8})}</span>
        </li>`;
    });
}

function renderRates(json) {
    usdRate.textContent = (json.conversiones_fiat && json.conversiones_fiat['Dólar estadounidense']) ?
        Number(json.conversiones_fiat['Dólar estadounidense']).toLocaleString('es-ES', {minimumFractionDigits:2, maximumFractionDigits:2}) : '-';
    eurRate.textContent = (json.conversiones_fiat && json.conversiones_fiat['Euro']) ?
        Number(json.conversiones_fiat['Euro']).toLocaleString('es-ES', {minimumFractionDigits:2, maximumFractionDigits:2}) : '-';
}

function setCache(data, monto) {
    localStorage.setItem(CACHE_KEY, JSON.stringify({
        data, monto, ts: Date.now()
    }));
}

function getCache(monto) {
    try {
        const cache = JSON.parse(localStorage.getItem(CACHE_KEY));
        if (!cache) return null;
        if (cache.monto == monto && Date.now() - cache.ts < CACHE_TIME) {
            return cache.data;
        }
        return null;
    } catch { return null; }
}

async function fetchCambio(monto) {
    setLoading();
    let cache = getCache(monto);
    if (cache) {
        renderAll(cache);
        return;
    }
    let url = `${API_URL}?monto_bob=${monto}`;
    let res = await fetch(url);
    let json = await res.json();
    setCache(json, monto);
    renderAll(json);
}

function renderAll(json) {
    renderRates(json);
    renderFiat(json.conversiones_fiat || {});
    renderCripto(json.conversiones_cripto || {});
}

form.addEventListener('submit', e => {
    e.preventDefault();
    let monto = parseFloat(montoInput.value);
    if (!monto || monto <= 0) return;
    fetchCambio(monto);
});

// Inicializar con 1000
window.onload = () => {
    montoInput.value = 1000;
    fetchCambio(1000);
};
</script>
</body>
</html>
