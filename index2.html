<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Calculadora al Paralelo</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body { background: #f7f9fb; margin: 0; font-family: 'Montserrat', sans-serif; }
    .main-card { background: #fff; box-shadow: 0 4px 24px 0 #4d3fff11; border-radius: 32px; max-width: 440px; margin: 40px auto; }
    .header { background: linear-gradient(120deg, #3943ff 0%, #9a8dff 100%); border-radius: 32px 32px 0 0; color: #fff; padding: 38px 36px 22px 36px; }
    .header h1 { margin: 0 0 12px 0; font-size: 2.2rem; font-weight: 700; letter-spacing: -2px; }
    .header p { margin: 0; font-size: 1.09rem; font-weight: 400; opacity: 0.91; }
    .form-section { padding: 20px 30px 8px 30px; }
    .input-group { display: flex; }
    .input-monto { flex: 1; border-radius: 14px 0 0 14px; border: 1.5px solid #dde1ee; padding: 16px; font-size: 1.2rem; outline: none; }
    .btn-bob { background: #3943ff; color: #fff; border: none; border-radius: 0 14px 14px 0; padding: 0 34px; font-size: 1.12rem; cursor: pointer; font-weight: 700; transition: background 0.2s; }
    .btn-bob:hover { background: #232aed; }
    .res-cards { display: flex; gap: 16px; margin: 26px 0 12px 0; }
    .res-card { flex: 1; background: #f6f7ff; border-radius: 14px; padding: 19px 0 13px 0; text-align: center; box-shadow: 0 2px 10px #18174811; }
    .res-label { font-size: 0.99rem; color: #7381ad; letter-spacing: 1px; }
    .res-value { font-size: 2rem; font-weight: bold; margin-top: 2px; letter-spacing: 1px; color: #3943ff; }
    .section-title { font-weight: 700; font-size: 1.12rem; color: #2d388a; display: flex; align-items: center; gap: 10px; margin: 23px 0 6px 0; }
    .section-title svg { width: 21px; height: 21px; }
    .coin-list { margin: 0; padding: 0; list-style: none; }
    .coin-item { display: flex; align-items: center; padding: 17px 0; border-bottom: 1px solid #f0f1f6; }
    .coin-item:last-child { border-bottom: none; }
    .coin-img { width: 38px; height: 38px; border-radius: 50%; background: #fff; object-fit: contain; margin-right: 18px; border: 1.5px solid #f1f2fb; }
    .coin-main { flex: 1; }
    .coin-name { font-size: 1.04rem; font-weight: 500; color: #1d223c; }
    .coin-code { font-size: 0.92rem; color: #9ba2be; }
    .coin-value { font-size: 1.14rem; font-weight: bold; color: #2432a0; min-width: 70px; text-align: right; }
    @media (max-width: 700px) { .main-card { max-width: 99vw; border-radius: 0; } .header { border-radius: 0; padding: 26px 16px 16px 16px; } .form-section { padding: 12px 10px 8px 10px; } }
  </style>
</head>
<body>
  <div class="main-card">
    <div class="header">
      <h1>Calculadora al Paralelo</h1>
      <p>Convierte BOB a diferentes monedas al instante</p>
    </div>
    <div class="form-section">
      <form id="calcForm" autocomplete="off">
        <div class="input-group">
          <input type="number" class="input-monto" id="montoInput" min="1" value="1000" required />
          <button class="btn-bob" type="submit">BOB</button>
        </div>
      </form>
      <div class="res-cards">
        <div class="res-card">
          <div class="res-label">USD/BOB</div>
          <div class="res-value" id="usdRate">-</div>
        </div>
        <div class="res-card">
          <div class="res-label">EUR/BOB</div>
          <div class="res-value" id="eurRate">-</div>
        </div>
      </div>
      <div class="section-title"><svg fill="none" stroke="#3943ff" stroke-width="2" viewBox="0 0 24 24"><path d="M4 17v2a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-2"></path><path d="M7 9l5-5 5 5M12 4.5v12.5"></path></svg>Monedas tradicionales</div>
      <ul class="coin-list" id="fiatList"></ul>
      <div class="section-title"><svg fill="#3943ff" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><path d="M9 9l3 3-3 3" stroke="#fff" stroke-width="2"/></svg>Criptomonedas</div>
      <ul class="coin-list" id="cryptoList"></ul>
    </div>
  </div>
  <script>
// === CONFIG ===
const fiatCurrencies = [
  { name: 'Dólar estadounidense', code: 'USD', icon: 'https://currencyfreaks.com/photos/flags/usd.png' },
  { name: 'Euro', code: 'EUR', icon: 'https://currencyfreaks.com/photos/flags/eur.png' },
  { name: 'Peso colombiano', code: 'COP', icon: 'https://currencyfreaks.com/photos/flags/cop.png' },
  { name: 'Peso argentino', code: 'ARS', icon: 'https://currencyfreaks.com/photos/flags/ars.png' },
  { name: 'Peso chileno', code: 'CLP', icon: 'https://currencyfreaks.com/photos/flags/clp.png' },
  { name: 'Real brasileño', code: 'BRL', icon: 'https://currencyfreaks.com/photos/flags/brl.png' },
  { name: 'Sol peruano', code: 'PEN', icon: 'https://currencyfreaks.com/photos/flags/pen.png' },
  { name: 'Yuan chino', code: 'CNY', icon: 'https://currencyfreaks.com/photos/flags/cny.png' },
  { name: 'Guaraní paraguayo', code: 'PYG', icon: 'https://currencyfreaks.com/photos/flags/pyg.png' },
  { name: 'Peso mexicano', code: 'MXN', icon: 'https://currencyfreaks.com/photos/flags/mxn.png' }
];
const cryptoCurrencies = [
  { name: 'Tether (USDT)', code: 'USDT', icon: 'paralelo/1.png' },
  { name: 'BTC', code: 'BTC', icon: 'paralelo/2.png' },
  { name: 'ETH', code: 'ETH', icon: 'paralelo/3.png' },
  { name: 'USDC', code: 'USDC', icon: 'paralelo/4.png' },
  { name: 'DOGE', code: 'DOGE', icon: 'paralelo/5.png' },
  { name: 'SOL', code: 'SOL', icon: 'paralelo/6.png' },
  { name: 'PEPE', code: 'PEPE', icon: 'paralelo/7.png' },
  { name: 'TRUMP', code: 'TRUMP', icon: 'paralelo/8.png' }
];
// === CACHÉ SETTINGS ===
const CACHE_KEY = 'cambio_parallel_cache_v2';
const CACHE_MINUTES = 2;
const API_URL = 'https://api.lupo.lat/convertir_bob?monto_bob=';

// === FUNCIONES ===
function setCache(data) {
  const now = Date.now();
  localStorage.setItem(CACHE_KEY, JSON.stringify({ data, time: now }));
}
function getCache() {
  const cache = localStorage.getItem(CACHE_KEY);
  if (!cache) return null;
  try {
    const { data, time } = JSON.parse(cache);
    if ((Date.now() - time) < CACHE_MINUTES * 60 * 1000) {
      return data;
    }
    return null;
  } catch { return null; }
}
async function fetchRates(monto) {
  try {
    const res = await fetch(API_URL + monto);
    return await res.json();
  } catch (e) { return null; }
}
function formatNum(n) {
  return n >= 1000 ? n.toLocaleString('es-ES', { minimumFractionDigits: 2, maximumFractionDigits: 2 }) : n.toLocaleString('es-ES', { maximumFractionDigits: 2 });
}
function setFiatCoins(convsFiat) {
  let html = '';
  fiatCurrencies.forEach(cur => {
    let val = convsFiat[cur.name] ?? convsFiat[cur.code] ?? 0;
    html += `<li class="coin-item"><img class="coin-img" src="${cur.icon}" alt="${cur.code}"><div class="coin-main"><div class="coin-name">${cur.name}</div><div class="coin-code">${cur.code}</div></div><div class="coin-value">${formatNum(val)}</div></li>`;
  });
  document.getElementById('fiatList').innerHTML = html;
}
function setCryptoCoins(convsCrypto) {
  let html = '';
  cryptoCurrencies.forEach(cur => {
    let val = convsCrypto[cur.name] ?? convsCrypto[cur.code] ?? 0;
    html += `<li class="coin-item"><img class="coin-img" src="${cur.icon}" alt="${cur.code}"><div class="coin-main"><div class="coin-name">${cur.name}</div><div class="coin-code">${cur.code}</div></div><div class="coin-value">${formatNum(val)}</div></li>`;
  });
  document.getElementById('cryptoList').innerHTML = html;
}
function setMainRates(data) {
  document.getElementById('usdRate').textContent = formatNum(data.tc_bob_usd || 0);
  document.getElementById('eurRate').textContent = data.conversiones_fiat && data.conversiones_fiat["Euro"] ? formatNum(data.conversiones_fiat["Euro"]) : '-';
}
// === EVENTOS PRINCIPALES ===
async function update(monto) {
  let cacheData = getCache();
  if (cacheData && cacheData.monto_bob == monto) {
    setMainRates(cacheData);
    setFiatCoins(cacheData.conversiones_fiat || {});
    setCryptoCoins(cacheData.conversiones_crypto || {});
    return;
  }
  let res = await fetchRates(monto);
  if (res && res.monto_bob == monto) {
    setCache(res);
    setMainRates(res);
    setFiatCoins(res.conversiones_fiat || {});
    setCryptoCoins(res.conversiones_crypto || {});
  } else {
    // fallback: muestra vacío
    setMainRates({});
    setFiatCoins({});
    setCryptoCoins({});
  }
}
document.getElementById('calcForm').onsubmit = e => {
  e.preventDefault();
  let val = parseFloat(document.getElementById('montoInput').value) || 1;
  update(val);
};
// Carga inicial
update(parseFloat(document.getElementById('montoInput').value) || 1000);
  </script>
</body>
</html>
